<project>
	<resources prefab="prefabs/resources.xml">
		<private>
			<buffer name="floorHit" elements=512 type="float"/>
		</private>

		<global>
			<uniform name="virusAnimationRadius" type="float" value=3 />
			<buffer name="virusPos" elements=512 type="vec4"/>
			<uniform name="virusAnimationAngle" type="float" value=180/>
			<uniform name="virusAnimationAngle" type="bool" value=180/>
		</global>
	</resources>

	<psystem name="puddle">
		<position x=0 y=0 z=-5 />
		<rotation x=1 y=0 z=0 angle=0/>
		<scale x=1 y=1 z=1 />
		<lifetime value=3 />
		<numWorkGroups value=1 />

		<override type="uniform" name="puddle_toCreate" value=2/>
		<override type="uniform" name="puddle_maxParticles" value=500/>


		<emitter iterationStep=100>
			<override type="atomic" name="puddle_emissionAttempts" value=0/>

			<file path="reserved/utilities.glsl" />
			<file path="reserved/emission.glsl" />
			<file path="shaders/virusPuddles/puddleEmitter.comp" />
		</emitter>


		<updater iterationStep=0>
			<file path="reserved/utilities.glsl" />
			<file path="reserved/emission.glsl" />
			<file path="shaders/virusPuddles/puddleUpdater.comp" />
		</updater>


		<renderer>
			<rendertype type="billboard" path="snow.png" />
			
			<vertfile path="shaders/virusPuddles/puddleVertex.vert" />
			<geomfile path="reserved/utilities.glsl" />
			<geomfile path="reserved/billboard.glsl" />
			<geomfile path="shaders/virusPuddles/puddleGeom.geom"/>
			<fragfile path="shaders/virusPuddles/puddleFrag.frag" />
		</renderer>
	</psystem>

	<psystem name="virus">
		<position x=0 y=0 z=-5 />
		<rotation x=1 y=0 z=0 angle=0/>
		<scale x=1 y=1 z=1 />
		<lifetime value=3600 />
		<numWorkGroups value=1 />

		<override type="uniform" name="virus_toCreate" value=1/>
		<override type="uniform" name="virus_maxParticles" value=1/>

		<emitter iterationStep=100>
			<override type="atomic" name="virus_emissionAttempts" value=0/>

			<file path="reserved/utilities.glsl" />
			<file path="reserved/emission.glsl" />
			<file path="shaders/virusPuddles/virusEmitter.comp" />
		</emitter>

		<updater iterationStep=0>
			<file path="reserved/utilities.glsl" />
			<file path="reserved/emission.glsl" />
			<file path="shaders/virusPuddles/virusUpdater.comp" />
		</updater>

		<renderer>
			<rendertype type="model" path="assets/models/virus/virus.3ds"/>
			
			<vertfile path="reserved/utilities.glsl" />
			<vertfile path="shaders/virusPuddles/virusVertex.vert" />
			<fragfile path="shaders/virusPuddles/virusFrag.frag" />
		</renderer>

	</psystem>
</project>