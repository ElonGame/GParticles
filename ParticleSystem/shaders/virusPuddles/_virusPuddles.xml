<project>
	<resources prefab="prefabs/resources.xml">
		<private>
			<buffer name="floorHit" elements=512 type="float"/>
		</private>

		<global>
			<uniform name="virusAnimationRadius" type="float" value=3 />
			<buffer name="virusPos" elements=512 type="vec4"/>
			<uniform name="virusAnimationAngle" type="float" value=180/>
		</global>
	</resources>


	<psystem name="virus">
		<position x=0 y=0 z=-5 />
		<rotation x=1 y=0 z=0 angle=0/>
		<scale x=1 y=1 z=1 />
		<lifetime value=3 unit="seconds" looping="true" />
		<numWorkGroups value=1 />

		<override type="uniform" name="toCreate" value=1/>
		<override type="uniform" name="maxParticles" value=1/>

		<events>
			<emission iterationStep=0>
				<override type="atomic" name="emissionAttempts" value=0/>

				<file path="modules/utilities.glsl" />
				<file path="modules/emission.glsl" />
				<file path="shaders/virusPuddles/virusEmission.comp" />
				<template path="templates/emissionMain.glsl" />
			</emission>

			<update iterationStep=0>
				<file path="modules/utilities.glsl" />
				<file path="shaders/virusPuddles/virusUpdate.comp" />
				<template path="templates/updateMain.glsl" />
			</update>


			<render>
				<rendertype type="model" path="assets/models/virus/virus.3ds"/>
				
				<vertfile path="modules/utilities.glsl" />
				<vertfile path="shaders/virusPuddles/virusVertex.vert" />
				<fragfile path="shaders/virusPuddles/virusFrag.frag" />
			</render>
		</events>
	</psystem>


	<psystem name="puddle">
		<position x=0 y=0 z=-5 />
		<rotation x=1 y=0 z=0 angle=0/>
		<scale x=1 y=1 z=1 />
		<lifetime value=3 unit="seconds"/>
		<numWorkGroups value=1 />

		<override type="uniform" name="toCreate" value=2/>
		<override type="uniform" name="maxParticles" value=500/>

		<colliders>
			<static type="sphere" x=0 y=-2 z=-3 r=1 />
			<static type="sphere" x=-3 y=-2 z=0 r=1 />
			<static type="plane" x=0 y=1 z=0 d=3 />
		</colliders>

		<events>
			<emission iterationStep=100>
				<override type="atomic" name="emissionAttempts" value=0/>

				<file path="modules/utilities.glsl" />
				<file path="modules/emission.glsl" />
				<file path="shaders/virusPuddles/puddleEmission.comp" />
				<template path="templates/emissionMain.glsl" />
			</emission>


			<update iterationStep=0>
				<file path="modules/utilities.glsl" />
				<file path="shaders/virusPuddles/puddleUpdate.comp" />
				<file path="shaders/virusPuddles/puddleCollision.comp" />
				<template path="templates/collision.glsl" />
				<template path="templates/updateMain.glsl" />
			</update>


			<render>
				<rendertype type="billboard" path="snow.png" />
				
				<vertfile path="shaders/virusPuddles/puddleVertex.vert" />
				<geomfile path="modules/utilities.glsl" />
				<geomfile path="modules/billboard.glsl" />
				<geomfile path="shaders/virusPuddles/puddleGeom.geom"/>
				<fragfile path="shaders/virusPuddles/puddleFrag.frag" />
			</render>
		</events>
	</psystem>
</project>